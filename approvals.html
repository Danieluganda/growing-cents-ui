<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Approvals â€“ Growing Cents</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Marcellus&display=swap" rel="stylesheet" />
  <!-- FontAwesome for icons -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  />
  <!-- jsPDF and autoTable for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <style>
    /* ====== Variables & Reset ====== */
    :root {
      --bg-dark: #103125;
      --accent-gold: #C39E3D;
      --light-text: #ffffff;
      --card-bg: #fefefe;
      --text-dark: #2c3e50;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-dark);
      color: var(--light-text);
      display: flex;
      min-height: 100vh;
      flex-direction: row;
    }

    /* Sidebar container */
    #sidebar-container {
      flex-shrink: 0;
      height: 100vh;
      overflow-y: auto;
      width: 260px;
      background-color: var(--bg-dark);
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
    }

    /* Main content */
    main.content {
      flex-grow: 1;
      padding: 40px 50px;
      overflow-y: auto;
      background: var(--bg-dark);
      min-width: 0; /* prevent overflow */
    }
    main.content header h1 {
      font-family: 'Marcellus', serif;
      color: var(--accent-gold);
      font-size: 2.2rem;
      margin-bottom: 0.2em;
    }
    main.content header p {
      margin-top: 0;
      font-size: 1.1rem;
      color: #ddd;
      margin-bottom: 2rem;
    }

    /* Section styling */
    section {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      color: var(--text-dark);
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: var(--bg-dark);
    }

    /* Search box styling */
    #search-input {
      width: 100%;
      max-width: 300px;
      padding: 10px 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }
    th, td {
      padding: 14px 18px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #e8f0ee;
      color: #333;
    }
    tbody tr:hover {
      background-color: #f9f9f9;
      cursor: default;
    }

    /* User name clickable style */
    .user-name {
      color: var(--accent-gold);
      cursor: pointer;
      font-weight: 600;
      text-decoration: underline;
    }
    .user-name:hover {
      color: #a67c1a;
    }

    /* Buttons */
    .btn-approve, .btn-reject, #export-pdf-btn {
      padding: 8px 14px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      margin-right: 6px;
      transition: background-color 0.2s ease;
      font-size: 0.9rem;
    }
    .btn-approve {
      background-color: #2ecc71;
    }
    .btn-approve:hover {
      background-color: #27ae60;
    }
    .btn-reject {
      background-color: #e74c3c;
    }
    .btn-reject:hover {
      background-color: #c0392b;
    }
    #export-pdf-btn {
      background-color: var(--accent-gold);
      color: var(--bg-dark);
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #export-pdf-btn:hover {
      background-color: #a67c1a;
    }

    /* Modal styling */
    .modal-overlay {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px 30px;
      max-width: 480px;
      width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      color: var(--text-dark);
      position: relative;
    }
    .modal h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: var(--bg-dark);
      font-family: 'Marcellus', serif;
    }
    .modal p {
      margin: 6px 0;
      font-size: 1rem;
    }
    .modal button.close-modal {
      position: absolute;
      top: 12px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--bg-dark);
      font-weight: bold;
      line-height: 1;
    }
    .modal button.close-modal:hover {
      color: var(--accent-gold);
    }

    /* Responsive */
    @media (max-width: 900px) {
      body {
        flex-direction: column;
      }
      #sidebar-container {
        height: auto;
        width: 100%;
        order: 1;
        box-shadow: none;
      }
      main.content {
        padding: 20px;
        order: 2;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        display: none;
      }
      tbody tr {
        margin-bottom: 1.5em;
        background: var(--card-bg);
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }
      tbody tr td {
        padding: 8px 10px;
        border: none;
        text-align: right;
        position: relative;
        padding-left: 50%;
        font-size: 0.95rem;
      }
      tbody tr td::before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-weight: 700;
        color: var(--bg-dark);
        white-space: nowrap;
      }
      tbody tr td:last-child {
        padding-left: 15px;
        text-align: center;
      }
      .btn-approve, .btn-reject {
        font-size: 0.9rem;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>

  <div id="sidebar-container"></div>

  <main class="content">
    <header>
      <h1>User Approvals</h1>
      <p>Review and approve club member accounts and club creation requests.</p>
    </header>

    <section>
      <button id="export-pdf-btn" aria-label="Export user approvals list to PDF">
        <i class="fa fa-file-pdf"></i> Export to PDF
      </button>

      <input
        type="search"
        id="search-input"
        placeholder="Search user approvals..."
        aria-label="Search user approvals"
      />

      <h2>Pending User Approvals</h2>
      <table id="approvals-table" aria-describedby="user-approvals-description" role="table">
        <thead>
          <tr>
            <th scope="col">Full Name</th>
            <th scope="col">Email</th>
            <th scope="col">Requested Club</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-label="Full Name"><span class="user-name" tabindex="0" role="button" aria-pressed="false">Sarah Nuwandinda</span></td>
            <td data-label="Email">sarah@example.com</td>
            <td data-label="Requested Club">Green Harvest</td>
            <td data-label="Actions">
              <button class="btn-approve">Approve</button>
              <button class="btn-reject">Reject</button>
            </td>
          </tr>
          <tr>
            <td data-label="Full Name"><span class="user-name" tabindex="0" role="button" aria-pressed="false">David Okello</span></td>
            <td data-label="Email">david@example.com</td>
            <td data-label="Requested Club">Club not found</td>
            <td data-label="Actions">
              <button class="btn-approve">Approve</button>
              <button class="btn-reject">Reject</button>
            </td>
          </tr>
          <!-- Add more rows as needed -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- User Details Modal -->
  <div class="modal-overlay" id="user-details-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="modal">
      <button class="close-modal" aria-label="Close user details modal">&times;</button>
      <h3 id="modal-title">User Details</h3>
      <div id="modal-desc">
        <p><strong>Full Name:</strong> <span id="detail-fullname"></span></p>
        <p><strong>Email:</strong> <span id="detail-email"></span></p>
        <p><strong>Requested Club:</strong> <span id="detail-club"></span></p>
        <p><strong>Additional Info:</strong> <span id="detail-additional">No additional details available.</span></p>
      </div>
    </div>
  </div>

  <script>
    // Load sidebar menu from external file
    fetch('admin-menu.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('sidebar-container').innerHTML = html;

        // Initialize submenu toggles after loading menu
        document.querySelectorAll('.menu-toggle').forEach(button => {
          button.addEventListener('click', () => {
            const submenu = button.nextElementSibling;
            submenu.classList.toggle('show');
          });
        });
      })
      .catch(err => console.error('Failed to load menu:', err));

    // Search/filter functionality
    const searchInput = document.getElementById('search-input');
    const table = document.getElementById('approvals-table');
    const tbody = table.querySelector('tbody');

    searchInput.addEventListener('input', () => {
      const filter = searchInput.value.toLowerCase();
      [...tbody.rows].forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
      });
    });

    // User details modal handling
    const modal = document.getElementById('user-details-modal');
    const detailFullName = document.getElementById('detail-fullname');
    const detailEmail = document.getElementById('detail-email');
    const detailClub = document.getElementById('detail-club');
    const detailAdditional = document.getElementById('detail-additional');
    const closeModalBtn = modal.querySelector('.close-modal');

    // Mock additional user data for demo purposes (replace with real data or API call)
    const userDetailsData = {
      "Sarah Nuwandinda": {
        email: "sarah@example.com",
        club: "Green Harvest",
        additional: "Member since 2023, pending approval for premium tier."
      },
      "David Okello": {
        email: "david@example.com",
        club: "Club not found",
        additional: "Requested club creation, awaiting verification."
      }
    };

    // Open modal on clicking user name
    document.querySelectorAll('.user-name').forEach(elem => {
      elem.addEventListener('click', () => {
        const name = elem.textContent.trim();
        const data = userDetailsData[name] || {};
        detailFullName.textContent = name;
        detailEmail.textContent = data.email || 'N/A';
        detailClub.textContent = data.club || 'N/A';
        detailAdditional.textContent = data.additional || 'No additional details available.';
        modal.classList.add('active');
        elem.setAttribute('aria-pressed', 'true');
        // Set focus inside modal for accessibility
        closeModalBtn.focus();
      });
      // Keyboard accessibility: open modal on Enter or Space
      elem.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          elem.click();
        }
      });
    });

    // Close modal
    closeModalBtn.addEventListener('click', () => {
      modal.classList.remove('active');
      // Restore focus to last focused user name
      document.querySelector('.user-name[aria-pressed="true"]').focus();
      document.querySelector('.user-name[aria-pressed="true"]').setAttribute('aria-pressed', 'false');
    });

    // Close modal on clicking outside modal content
    modal.addEventListener('click', e => {
      if(e.target === modal) {
        closeModalBtn.click();
      }
    });

    // Export to PDF function
    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'landscape',
        unit: 'pt',
        format: 'a4'
      });

      const gold = '#C39E3D';
      const dark = '#103125';

      // Placeholder logo base64 (replace with actual company logo base64 or URL)
      const logoBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOwwAADsMBx2+oZAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjM2qefiJQAAAH5JREFUWIXt1zEOgCAMBFD/fzOq09qQIjJbq+MxVnpk6IoMAtQIodBI6QF5H3n5QuMYUSXn4r1DnAVHlTi6NGicvmPQlSCoUyEMwgkgJQyAySMuEPOv3A9KX/6zqOfvH9fXpCqEbdlhg1fVxTQG6yChAqHkVbqFGDk2PxVkQ60Fr1Q7Gk6QY56pYxJo2pNjrGwJ6uWslvP3pVWwAAAABJRU5ErkJggg==';

      doc.addImage(logoBase64, 'PNG', 40, 20, 40, 40);

      // Header
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(26);
      doc.setTextColor(gold);
      doc.text('Growing Cents', 90, 50);

      doc.setFontSize(14);
      doc.setTextColor(dark);
      doc.text('Pending User Approvals Report', 90, 70);

      // Collect table data
      const tableRows = [];
      const rows = document.querySelectorAll('#approvals-table tbody tr');
      rows.forEach(row => {
        if(row.style.display === 'none') return; // skip hidden rows by search filter
        const cols = row.querySelectorAll('td');
        if (cols.length >= 3) {
          tableRows.push([
            cols[0].textContent.trim(),
            cols[1].textContent.trim(),
            cols[2].textContent.trim(),
          ]);
        }
      });

      doc.autoTable({
        startY: 100,
        head: [['Full Name', 'Email', 'Requested Club']],
        body: tableRows,
        theme: 'grid',
        styles: {
          font: 'helvetica',
          fontSize: 11,
          cellPadding: 5,
          textColor: dark,
          lineColor: gold,
          lineWidth: 0.5,
        },
        headStyles: {
          fillColor: gold,
          textColor: 255,
          fontStyle: 'bold',
          halign: 'center',
        },
        alternateRowStyles: {
          fillColor: '#f9f5e7',
        },
        margin: { left: 40, right: 40 },
        didDrawPage: function (data) {
          let str = 'Page ' + doc.internal.getNumberOfPages();
          doc.setFontSize(10);
          doc.setTextColor(dark);
          doc.text(str, data.settings.margin.left, doc.internal.pageSize.height - 20);
        },
      });

      doc.save('GrowingCents_UserApprovals_Report.pdf');
    }

    document.getElementById('export-pdf-btn').addEventListener('click', exportToPDF);
  </script>
</body>
</html>
